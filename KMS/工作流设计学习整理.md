> 在原有系统中，新的业务需求地不断叠加，原有流程复用可维护性越来越差，重构系统的工作中，对于现有流程的梳理，对应工作流引擎，用于扩展业务流程的通用性。

## 工作流引擎介绍

工作流（Workflow）就是工作流程的计算模型，即将工作流程中的工作如何前后组织在一起的逻辑和规则在计算机中以恰当的模型进行表示并对其实施计算。工作流要解决的主要问题是：为实现某个业务目标，在多个参与者之间，利用计算机，按某种预定规则自动传递文档、信息或者任务。通用型的工作流引擎，有例如jBPM5与Activiti和tbbpm。

通过工作流可以通过预设业务工作流程，通过节点用户与任务实现流程的完整操作，提高系统通用性和降低成本。


## 工作流数据库设计


通用工作流数据库设计如下

- process_template（工作流流程定义）

字段名称 | 字段含义
---|---
id | 工作流模板ID
process_name | 流程名称
process_type | 流程类型
process_detail | 流程详细配置定义
process_version | 流程版本
status | 工作流模板状态


- process_flow（工作流流程路由）

字段名称 | 字段含义
---|---
id | 工作流路由ID
process_id | 工作流模板ID
current_node_index | 工作流节点序号
current_node_id | 工作流节点ID
from_node_id | 上一个工作流节点ID（开始为0）
next_node_id | 下一个工作流节点ID（结束为0）
flow_detail | 当前节点描述
flow_condition | 工作流路由判断规则


- process_node（工作流流程节点）

字段名称 | 字段含义
---|---
id | 工作流节点ID
process_id | 工作流模板ID
node_name | 工作流节点名称
node_type | 工作流节点类型
node_category | 工作流节点种类
node_detail | 工作流节点配置信息
node_execute_type | 工作流节点执行类型
node_execute_user | 工作流节点执行用户配置
node_execute_function | 工作流节点执行逻辑

- process_node_user（工作流流程用户权限）

字段名称 | 字段含义
---|---
id | ID
process_id | 工作流模板ID
node_id | 工作流节点ID
execute_user | 工作流节点用户ID
execute_user_type | 工作流节点用户类型
execute_user_role | 工作流节点用户角色权限配置


- process_instance（工作流实例）

字段名称 | 字段含义
---|---
id | 工作流实例ID
process_id | 工作流模板ID
process_type | 工作流类型
title | 工作流实例名称
current_node_id | 当前所在节点ID
current_node_index | 当前所在节点序号
current_user_id | 当前未操作用户ID
context | 当前业务上下文变量
status | 当前流程状态（初始化，运行中，挂起，结束，终止）
start_user_id | 创建工作流实例用户ID
start_time | 工作流实例开始时间
finish_time | 工作流实例结束时间


- process_instance_node （工作流节点实例）

字段名称 | 字段含义
---|---
id | 工作流节点实例ID
process_id | 工作流模板ID
process_instance_id | 工作流实例ID
node_id | 工作流节点ID
node_index | 工作流节点序号
node_type | 工作流节点类型
node_category | 工作流节点种类
current_user_id | 工作流节点当前操作用户
status | 工作流节点状态（未开始，初始化，就绪等待，完成，挂起，终止）
start_time | 工作流节点开始时间
finish_time | 工作流节点结束时间


- process_instance_node_task（工作流节点用户任务实例）

字段名称 | 字段含义
---|---
id | 工作流节点实例ID
process_id | 工作流模板ID
process_instance_id | 工作流实例ID
process_instance_node_id | 工作流节点实例ID
user_id | 工作流节点任务用户ID
execute_order | 工作流节点任务执行顺序
type | 工作流节点任务类型
status | 工作流节点任务状态（就绪等待，完成，终止）
start_time | 工作流节点任务开始时间
finish_time | 工作流节点任务结束时间
max_time | 工作流节点任务最大执行时间
execute_detail | 工作流节点任务执行详情



## 工作流后期实践计划

目前在业务系统中参考设计了通用流程相关数据库字段，对于实际业务流程中对接和状态转换，仍然需要详细适配设计优化，要实现真正意义上通用的工作流还需要去做更多的分析和研究。



## 参考文献
- https://blog.csdn.net/gaoolp/article/details/81179214
- https://learnku.com/articles/4627/workflow-based-on-laravel
- https://www.cnblogs.com/baocheng/p/5778869.html